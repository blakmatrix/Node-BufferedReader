"use strict";var EVENTS=require("events"),FS=require("fs"),PATH=require("path"),BUFFER_SIZE=16384,SLASH=PATH.normalize("/"),getFileName=function(a){var b=process.mainModule.filename,c=b.substring(0,b.lastIndexOf(SLASH)),d=PATH.relative(process.cwd(),c);return PATH.join(d,a)},BufferedReader=function(a,b,c){EVENTS.EventEmitter.call(this);var d=arguments.length;d===1?(b=BUFFER_SIZE,c=null):d===2&&typeof b=="string"&&(c=b,b=BUFFER_SIZE),this._settings={encoding:c,bufferSize:b},this._fileName=getFileName(a)};BufferedReader.prototype=Object.create(EVENTS.EventEmitter.prototype),BufferedReader.prototype.constructor=BufferedReader,BufferedReader.prototype.read=function(){var a=FS.createReadStream(this._fileName,this._settings),b=this,c,d,b=this,e=this.listeners("character").length!==0||this.listeners("line").length!==0||this.listeners("byte").length!==0;a.on("data",function(f){d=f;var g=0,h,i,j=f.length;if(e){for(var k=0;k<j;k++){i=f[k];if(!a.encoding){b.emit("byte",i);continue}b.emit("character",i==="\r"?"\n":i);if(i==="\n"||i==="\r")h=f.slice(g,k),g=k+1,c&&(h=c.concat(h),c=null),k+1!==j&&i==="\r"&&f[k+1]==="\n"&&k++,b.emit("line",h)}if(a.encoding&&g!==j){var l=g===0?f:f.slice(g);c=c?c.concat(l):l}}b.emit("buffer",f)}),a.on("end",function(){e&&c&&b.emit("line",c),b.emit("end")}),a.on("error",function(a){b.emit("error",a)})},module.exports.BufferedReader=BufferedReader;