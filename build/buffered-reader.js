"use strict";var EVENTS=require("events"),FS=require("fs"),PATH=require("path"),BUFFER_SIZE=16384,SLASH=PATH.normalize("/"),getFileName=function(a){var b=process.mainModule.filename,c=b.substring(0,b.lastIndexOf(SLASH)),d=PATH.relative(process.cwd(),c);return PATH.join(d,a)},BufferedReader=function(a,b,c){EVENTS.EventEmitter.call(this);var d=arguments.length;d===1?(b=BUFFER_SIZE,c=null):d===2&&typeof b=="string"&&(c=b,b=BUFFER_SIZE),this._stream=FS.createReadStream(getFileName(a),{bufferSize:b,encoding:c});var e=this;this._stream.on("error",function(a){e.emit("error",a)})};BufferedReader.prototype=Object.create(EVENTS.EventEmitter.prototype),BufferedReader.prototype.constructor=BufferedReader,BufferedReader.prototype.read=function(){var a,b,c=this,d=this.listeners("character").length!==0||this.listeners("line").length!==0||this.listeners("byte").length!==0;this._stream.on("data",function(e){b=e;var f=0,g,h,i=e.length;if(d){for(var j=0;j<i;j++){h=e[j];if(!c._stream.encoding){c.emit("byte",h);continue}c.emit("character",h);var k=h==="\n"||h==="\r";k&&(g=e.slice(f,j++),f=j,a&&(g=a.concat(g),a=null),j+1!==i&&h==="\r"&&e[j+1]==="\n"&&j++,c.emit("line",g))}if(c._stream.encoding&&f!==i){var l=f===0?e:e.slice(f);a=a?a.concat(l):l}}c.emit("buffer",e)}),this._stream.on("end",function(){d&&a&&c.emit("line",a),c.emit("end")})},module.exports.BufferedReader=BufferedReader;